#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./setup_cron.sh [1|3|6]
#   1 - 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å (9:00)
#   3 - 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (9:00, 14:00, 19:00) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
#   6 - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤

SCRIPT_PATH="/opt/remnawave-STEALTHNET-Panel/run_auto_broadcasts.sh"

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—É—Å–∫–∞
FREQUENCY="${1:-3}"

case $FREQUENCY in
    1)
        CRON_JOB="0 9 * * * $SCRIPT_PATH"
        DESCRIPTION="–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00"
        ;;
    3)
        CRON_JOB="0 9,14,19 * * * $SCRIPT_PATH"
        DESCRIPTION="3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (9:00, 14:00, 19:00)"
        ;;
    6)
        CRON_JOB="0 */6 * * * $SCRIPT_PATH"
        DESCRIPTION="–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./setup_cron.sh [1|3|6]"
        exit 1
        ;;
esac

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x "$SCRIPT_PATH"

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–¥–∞—á—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
(crontab -l 2>/dev/null | grep -v "$SCRIPT_PATH" | grep -v "# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞"; echo ""; echo "# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –∞–≤—Ç–æ—Å–æ–æ–±—â–µ–Ω–∏–π - $DESCRIPTION"; echo "$CRON_JOB") | crontab -

echo "‚úÖ Cron –∑–∞–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞:"
echo "   –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: $DESCRIPTION"
echo "   –ö–æ–º–∞–Ω–¥–∞: $CRON_JOB"
echo ""
echo "üìã –¢–µ–∫—É—â–∏–µ cron –∑–∞–¥–∞—á–∏:"
crontab -l
echo ""
echo "üìÅ –õ–æ–≥–∏: /opt/remnawave-STEALTHNET-Panel/logs/auto_broadcasts.log"
echo ""
echo "üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   crontab -l          # –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á"
echo "   crontab -e          # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á"
echo "   $SCRIPT_PATH        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫"

